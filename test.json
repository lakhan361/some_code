{
   "AWSTemplateFormatVersion":"2010-09-09",
   "Description":"Redis Playground - ElastiCache for Redis cluster",
   "Parameters":{
      "StackNamePrefix":{
         "Type":"String"
      }
   },
   "Resources":{
      "SecurityGroup":{
         "Type":"AWS::EC2::SecurityGroup",
         "Properties":{
            "GroupDescription":{
               "Fn::Sub":"Security group for ${AWS::StackName}"
            },
            "GroupName":{
               "Fn::Sub":"${AWS::StackName}-sg"
            },
            "SecurityGroupIngress":[
               {
                  "IpProtocol":"tcp",
                  "FromPort":6379,
                  "ToPort":6379
               }
            ],
            "VpcId":"vpc-0607ea6166a8a7c44",
            "Tags":[
               {
                  "Key":"Name",
                  "Value":{
                     "Fn::Sub":"${AWS::StackName}-sg"
                  }
               }
            ]
         }
      },

      "ParameterGroupRedis60":{
         "Type":"AWS::ElastiCache::ParameterGroup",
         "Properties":{
            "Description":{
               "Fn::Sub":"Parameter Group for ${AWS::StackName} Redis cluster"
            },
            "CacheParameterGroupFamily":"redis5.0",
            "Properties":{
               "maxmemory-policy":"allkeys-lru"
            }
         }
      },
      "ReplicationGroup":{
         "Type":"AWS::ElastiCache::ReplicationGroup",
         "Properties":{
            "AtRestEncryptionEnabled":true,
            "AutomaticFailoverEnabled":true,
            "AutoMinorVersionUpgrade":true,
            "CacheNodeType":"cache.t2.micro",
            "CacheParameterGroupName":{
               "Ref":"ParameterGroupRedis60"
            },
            "CacheSubnetGroupName":  "lakhan-test",
            "Engine":"redis",
            "EngineVersion":"5.0.6",
            "ReplicasPerNodeGroup":1,
            "PreferredMaintenanceWindow":"mon:07:30-mon:08:30",
            "ReplicationGroupId":{
               "Fn::Sub":"${AWS::StackName}"
            },
            "ReplicationGroupDescription":{
               "Fn::Sub":"Redis Cluster ${AWS::StackName}"
            },
            "SecurityGroupIds":[
               "Fn::GetAtt":[
                  "SecurityGroup",
                  "GroupId"
               ]
            ],
            "SnapshotRetentionLimit":0,
            "TransitEncryptionEnabled":true,
            "MultiAZEnabled":true,
            "Tags":[
               {
                  "Key":"Name",
                  "Value":{
                     "Fn::Sub":"${AWS::StackName}"
                  }
               }
            ]
         }
      }
   }
}
